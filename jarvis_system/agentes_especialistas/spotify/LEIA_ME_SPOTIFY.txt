# üéµ M√≥dulo Especialista: Spotify (J.A.R.V.I.S.)

Este diret√≥rio cont√©m o "Agente Especialista" respons√°vel por controlar o Spotify. Ele opera como um sistema aut√¥nomo dentro do J.A.R.V.I.S., possuindo seu pr√≥prio ciclo de "Sentir, Pensar e Agir".

A arquitetura √© baseada em **Vis√£o Computacional**, **Mem√≥ria Espacial (Cache)** e **LLMs** para interpreta√ß√£o de inten√ß√£o.

---

## üìÇ Estrutura de Pastas e Arquivos

### 1. `agent/` (O Maestro)
Respons√°vel pelo ciclo de vida e orquestra√ß√£o do agente. √â o ponto de entrada.
* **`manager.py`**: A classe principal `AgenteSpotify`.
    * Gerencia o fluxo: `Consci√™ncia (Sentir)` -> `Brain (Pensar)` -> `Controller (Agir)`.
    * Realiza triagem inicial (sinais vitais, internet, verifica√ß√£o de processo) antes de qualquer a√ß√£o.
* **`config.py`**: Configura√ß√µes est√°ticas, como o nome do agente e as palavras-gatilho (ex: "tocar", "pausar", "spotify").

### 2. `brain/` (O C√©rebro Cognitivo)
Onde a decis√£o inteligente acontece. Transforma texto do usu√°rio em instru√ß√µes t√©cnicas.
* **`core.py` (`SpotifyBrain`)**: Analisa o input do usu√°rio. Decide se deve chamar o LLM (para inten√ß√µes complexas) ou usar o Sistema L√≠mbico (para comandos r√°pidos).
* **`llm_setup.py`**: F√°brica de conex√µes com IAs (Groq/Llama-3 ou Google Gemini).
* **`limbic_system.py`**: O "Sistema L√≠mbico" (R√°pido e Instintivo). Cont√©m regras Regex para comandos de m√≠dia (play, pause, next) que executam instantaneamente sem custo de API.
* **`tools.py`**: Defini√ß√µes das ferramentas que a IA pode "chamar" (ex: `play_music`, `get_artist`).

### 3. `consciencia/` (Sensores e Estado)
Monitora o ambiente antes de qualquer a√ß√£o.
* **`monitor.py`**: Verifica se o processo `Spotify.exe` est√° rodando e se h√° conex√£o com a internet.
* **`vitals.py`**: Agrega os sinais vitais do sistema.
* **`proprioception.py`**: Verifica se a janela do Spotify est√° vis√≠vel, foca a janela se necess√°rio e gerencia o estado "f√≠sico" do app.

### 4. `controller/` (O Sistema Nervoso)
Traduz as inten√ß√µes do C√©rebro em movimentos e coordena√ß√£o.
* **`spotify_controller.py`**: A interface p√∫blica de controle. Recebe comandos de alto n√≠vel (ex: `play_search`) e coordena os subm√≥dulos.
* **`visual_navigator.py`**: **[CR√çTICO]** O "Gerente de Navega√ß√£o".
    * √â o c√©rebro da navega√ß√£o visual.
    * Roteia o pedido para a estrat√©gia correta (`ArtistStrategy`, `PlaylistStrategy` ou `TrackStrategy`) baseada na inten√ß√£o.
    * Gerencia o `FilterManager` para garantir que estamos na aba certa antes de buscar.
* **`process_manager.py`**: Cuida de abrir, fechar, matar e reiniciar o processo do Spotify no Windows.

### 5. `strategies/` (Mem√≥ria Muscular & Estrat√©gias de Navega√ß√£o)
Aqui reside a intelig√™ncia de navega√ß√£o otimizada. Cada arquivo √© especialista em clicar em um tipo de conte√∫do.

* **`filter_manager.py` (V5.0 - Dual Slot Memory)**:
    * Gerencia os bot√µes de filtro no topo (Tudo, M√∫sicas, Artistas, Playlists).
    * **Recurso:** Usa **Mem√≥ria Dupla** (Principal e Backup). Se o layout muda (ex: janela redimensionada), ele tenta a posi√ß√£o anterior conhecida antes de escanear a tela, permitindo adapta√ß√£o instant√¢nea a mudan√ßas de layout.

* **`artist.py` (V6.1 - Sniper/Cannon)**:
    * Especialista em encontrar e tocar Artistas.
    * **Recurso:** Memoriza separadamente onde o artista aparece na lista E onde o bot√£o "Play" verde fica na p√°gina do artista. Usa valida√ß√£o visual local ("Sniper") antes de clicar para garantir precis√£o.

* **`playlist.py` (V5.0 - Dedicated Strategy)**:
    * Especialista em Playlists. Similar ao Artist, mas com mem√≥ria segregada.
    * **Recurso:** Garante que n√£o haja conflito de coordenadas entre bandas e playlists de mesmo nome e for√ßa o filtro correto.

* **`track.py` (V5.0 - Turbo Geometry)**:
    * Especialista em tocar m√∫sicas espec√≠ficas (Tracks).
    * **Recurso:** Prioriza velocidade extrema. Utiliza a √¢ncora visual do Filtro para calcular geometricamente a posi√ß√£o da primeira m√∫sica da lista (Offset fixo), realizando um "Clique Turbo" sem necessidade de leitura lenta de OCR da lista.

### 6. `vision/` (Os Olhos)
O sistema de vis√£o computacional.
* **`system.py`**: Gerencia screenshots e a interface com bibliotecas de OCR.
* **`ocr.py`**: Wrapper para o EasyOCR (ou Tesseract). L√™ texto da tela para identificar nomes de m√∫sicas e artistas.
* **`finder.py`**: Usa *Template Matching* (OpenCV) para encontrar √≠cones visuais exatos, como o bot√£o "Play Verde" (`play_spotify.png`).

### 7. `window/` & `input/` (Intera√ß√£o com SO)
Camada de baixo n√≠vel (Drivers).
* **`window/manager.py`**: Encontra a janela do Spotify, traz para frente, maximiza e gerencia geometria (Win32 API).
* **`input/manager.py`**: Simula intera√ß√µes humanas: teclado (atalhos como `Space`, `Ctrl+Right`) e cliques do mouse controlados.

### 8. `img/` (Ativos)
* Imagens de refer√™ncia `.png` usadas pelo `finder.py` para localizar bot√µes visuais na interface.

---

## ‚ö° Fluxo de Execu√ß√£o (Exemplo: "Tocar Playlist Foco")

1.  **Entrada:** Usu√°rio diz "Jarvis, ouvir playlist foco".
2.  **Agente:** `manager.py` valida internet e passa para o `brain`.
3.  **C√©rebro:** `core.py` (via LLM) decide: `{'acao': 'tocar', 'termo': 'foco', 'tipo': 'playlist'}`.
4.  **Controller:** Recebe a ordem e chama `visual_navigator.find_and_click("foco", tipo="playlist")`.
5.  **Navegador:**
    * Identifica o tipo "playlist".
    * Chama `filter_manager` para clicar no filtro "Playlists" (usando Cache Duplo se dispon√≠vel).
    * Delega para `PlaylistStrategy`.
6.  **Estrat√©gia (Playlist):**
    * **Sniper:** Verifica na mem√≥ria `playlist_pos_foco`. Se souber, valida e clica.
    * **Canh√£o:** Se n√£o souber, escaneia a lista, encontra "Foco", clica e aprende.
    * **Play:** Entra no perfil, busca o bot√£o Play (mem√≥ria ou vis√£o) e clica.
7.  **Resultado:** A playlist come√ßa a tocar.

---

## üß† Conceitos Chave Implementados

* **Sniper Mode:** Tenta clicar em coordenadas salvas na mem√≥ria (`spatial_memory`). Valida visualmente apenas um pequeno recorte (r√°pido).
* **Cannon Mode:** Escaneia a tela inteira com OCR (lento, mas robusto). Usado apenas quando o Sniper falha ou √© a primeira vez.
* **Self-Healing (Auto-Cura):** Se o layout muda e o Sniper falha, o sistema roda o Canh√£o e **atualiza a mem√≥ria** automaticamente para a pr√≥xima vez.
* **Dual-Slot Memory:** (Filtros) Guarda a posi√ß√£o atual e a posi√ß√£o anterior, permitindo alternar entre layouts (ex: com/sem sidebar) instantaneamente.
* **Router Inteligente:** O Navegador distingue entre Artistas, M√∫sicas e Playlists para usar a estrat√©gia de clique e mem√≥ria mais adequada para cada tipo de m√≠dia.